# Лабораторная работа 1

> Вариант: 409647

## Технологии

[![Made with: Java](https://img.shields.io/badge/Java-176579?style=for-the-badge&logo=coffeescript&logoColor=E78A2A)](https://www.java.com)
[![Made with: Jakarta EE](https://img.shields.io/badge/Jakarta%20EE-2F5D88?style=for-the-badge&logo=jakartaee)](https://www.java.com)

[![Made with: PostgreSQL](https://img.shields.io/badge/PostgreSQL-4169E1?style=for-the-badge&logo=postgresql&logoColor=white)](https://www.postgresql.org/)

[![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?logo=javascript&style=for-the-badge&logoColor=23272f)](https://developer.mozilla.org/docs/Web/JavaScript)
[![Made with: React](https://img.shields.io/badge/React-61DAFB?style=for-the-badge&logo=react&logoColor=23272f)](https://react.dev/)

## Задание

Реализовать информационную систему, которая позволяет взаимодействовать с объектами класса `Movie`, описание которого
приведено ниже:

```java
public class Movie {
    private long id; //Значение поля должно быть больше 0, Значение этого поля должно быть уникальным, Значение этого поля должно генерироваться автоматически
    private String name; //Поле не может быть null, Строка не может быть пустой
    private Coordinates coordinates; //Поле не может быть null
    private java.time.ZonedDateTime creationDate; //Поле не может быть null, Значение этого поля должно генерироваться автоматически
    private int oscarsCount; //Значение поля должно быть больше 0
    private float budget; //Значение поля должно быть больше 0
    private int totalBoxOffice; //Значение поля должно быть больше 0
    private MpaaRating mpaaRating; //Поле может быть null
    private Person director; //Поле не может быть null
    private Person screenwriter;
    private Person operator; //Поле может быть null
    private Integer length; //Поле может быть null, Значение поля должно быть больше 0
    private Integer goldenPalmCount; //Значение поля должно быть больше 0, Поле не может быть null
    private int usaBoxOffice; //Значение поля должно быть больше 0
    private String tagline; //Поле не может быть null
    private MovieGenre genre; //Поле может быть null
}

public class Coordinates {
    private Double x; //Значение поля должно быть больше -738, Поле не может быть null
    private long y; //Максимальное значение поля: 462
}

public class Person {
    private String name; //Поле не может быть null, Строка не может быть пустой
    private Color eyeColor; //Поле может быть null
    private Color hairColor; //Поле не может быть null
    private Location location; //Поле не может быть null
    private float weight; //Значение поля должно быть больше 0
    private Country nationality; //Поле может быть null
}

public class Location {
    private Float x; //Поле не может быть null
    private Double y; //Поле не может быть null
    private double z;
}

public enum MpaaRating {
    G,
    PG_13,
    R;
}

public enum MovieGenre {
    DRAMA,
    MUSICAL,
    TRAGEDY;
}

public enum Color {
    GREEN,
    YELLOW,
    BROWN;
}

public enum Country {
    UNITED_KINGDOM,
    FRANCE,
    INDIA,
    VATICAN,
    JAPAN;
}
```

Разработанная система должна удовлетворять следующим требованиям:

- Основное назначение информационной системы - управление объектами, созданными на основе заданного в варианте класса.
- Необходимо, чтобы с помощью системы можно было выполнить следующие операции с объектами: создание нового объекта,
  получение информации об объекте по ИД, обновление объекта (модификация его атрибутов), удаление объекта. Операции
  должны осуществляться в отдельных окнах (интерфейсах) приложения. При получении информации об объекте класса должна
  также выводиться информация о связанных с ним объектах.
- При создании объекта класса необходимо дать пользователю возможность связать новый объект с объектами вспомогательных
  классов, которые могут быть связаны с созданным объектом и уже есть в системе.
- Выполнение операций по управлению объектами должно осуществляться на серверной части (не на клиенте), изменения должны
  синхронизироваться с базой данных.
- На главном экране системы должен выводиться список текущих объектов в виде таблицы (каждый атрибут объекта - отдельная
  колонка в таблице). При отображении таблицы должна использоваться пагинация (если все объекты не помещаются на одном
  экране).
- Нужно обеспечить возможность фильтровать/сортировать строки таблицы, которые показывают объекты (по значениям любой из
  строковых колонок). Фильтрация элементов должна производиться только по полному совпадению.
- Переход к обновлению (модификации) объекта должен быть возможен из таблицы с общим списком объектов и из области с
  визуализацией объекта (при ее реализации).
- При добавлении/удалении/изменении объекта, он должен автоматически появиться/исчезнуть/измениться в интерфейсах у
  других пользователей, авторизованных в системе.
- Если при удалении объекта с ним связан другой объект, операция должна быть отменена, пользователю нужно сообщить о
  невозможности удаления объекта.
- Пользователи должны иметь возможность просмотра всех объектов. Для модификации объекта должно открываться отдельное
  диалоговое окно. При вводе некорректных значений в поля объекта должны появляться информативные сообщения о
  соответствующих ошибках.

В системе должен быть реализован отдельный пользовательский интерфейс для выполнения специальных операций над объектами:

- Вернуть количество объектов, значение поля `tagline` которых равно заданному.
- Вернуть количество объектов, значение поля `goldenPalmCount` которых меньше заданного.
- Вернуть количество объектов, значение поля `goldenPalmCount` которых больше заданного.
- Получить список режиссёров, ни один фильм которых не получил ни одного "Оскара".
- Добавить всем фильмам категории "R" по одному "Оскару".

Представленные операции должны быть реализованы в рамках компонентов бизнес-логики приложения без прямого использования
функций и процедур БД.

Особенности хранения объектов, которые должны быть реализованы в системе:

- Организовать хранение данных об объектах в реляционной СУБД (`PostgreSQL`). Каждый объект, с которым работает ИС,
  должен быть сохранен в базе данных.
- Все требования к полям класса (указанные в виде комментариев к описанию классов) должны быть выполнены на уровне `ORM`
  и БД.
- Для генерации поля `id` использовать средства базы данных.
- Для подключения к БД на кафедральном сервере использовать хост `pg`, имя базы данных - `studs`, имя
  пользователя/пароль совпадают с таковыми для подключения к серверу.

При создании системы нужно учитывать следующие особенности организации взаимодействия с пользователем:

- Система должна реагировать на некорректный пользовательский ввод, ограничивая ввод недопустимых значений и информируя
  пользователей о причине ошибки.
- Переходы между различными логически обособленными частями системы должны осуществляться с помощью меню.
- При добавлении/удалении/изменении объекта, он должен автоматически появиться/исчезнуть/измениться на области у всех
  других клиентов.

При разработке ИС должны учитываться следующие требования:

- В качестве основы для реализации ИС необходимо использовать `Java EE, Managed Beans`.
- Для создания уровня хранения необходимо использовать `EclipseLink`.
- Разные уровни приложения должны быть отделены друг от друга, разные логические части ИС должны находиться в отдельных
  компонентах.

## Как запустить

#### Бэк

> Версии везде указаны фиксированные, на них проводилась разработка

#### Шаг 1. Скачать Wildfly

```bash
wget https://github.com/wildfly/wildfly/releases/download/35.0.1.Final/wildfly-35.0.1.Final.zip
unzip wildfly-35.0.1.Final.zip
```

##### Шаг 1.1. Настроить порты

Так как порты по умолчанию, как правило, заняты, из следует поменять. Для этого в конце файла
`wildfly-35.0.1.Final/standalone/configuration/standalone.xml` нужно заменить как минимум порты `http` и `managed-http`.
Также можно опционально поменять и `https` порты, чтобы было меньше предупреждений при запуске.

```xml

<socket-binding-group name="standard-sockets" default-interface="public"
                      port-offset="${jboss.socket.binding.port-offset:0}">
    ...
    <socket-binding name="http" port="${jboss.http.port:8787}"/>
    <socket-binding name="https" port="${jboss.https.port:8788}"/>
    <socket-binding name="management-http" interface="management" port="${jboss.management.http.port:9595}"/>
    <socket-binding name="management-https" interface="management" port="${jboss.management.https.port:9596}"/>
    ...
</socket-binding-group>
```

#### Шаг 2. Скачать драйвер postgres

```bash
wget https://jdbc.postgresql.org/download/postgresql-42.7.7.jar
```

#### Шаг 3. Настроить модуль с драйвером

Для этого нужно в папку `wildfly-35.0.1.Final/modules/org/postgresql/main` положить jar с драйвером postgresql и рядом с
ним разместить файл [module.xml](config/module.xml)

> Папки `org/postgresql/main` нет по умолчанию, её нужно создать

#### Шаг 4. Выполнить конфигурацию Wildfly

Запускам wildfly

```bash
cd wildfly-35.0.1.Final
.wildfly-35.0.1.Final/bin/standalone.sh
```

Выполняем скрипт конфигурации, используя файл [configure-wildfly.cli](config/configure-wildfly.cli)

> ВАЖНО, порт 9595 это managed порт указанный в шаге 1.1

```bash
./bin/jboss-cli.sh --connect --controller=localhost:9595 --file=configure-wildfly.cli
```

В файле нужно не забыть изменить данные для подключения к бд:

```text
--connection-url=jdbc:postgresql://localhost:5432/pgdev \
--user-name=postgres \
--password=password \
```

#### Шаг 5. Загрузить схему БД

Используя файл со схемой [schema.sql](sql/schema.sql) загрузить схему

> Не забыть поменять данный подключения

```bash
psql -h localhost -U USERNAME -d DATABASE -f schema.sql
```

Опционально можно загрузить начальные данные, из файла [data.sql](sql/data.sql)

```bash
psql -h localhost -U USERNAME -d DATABASE -f data.sql
```

#### Шаг 6. Собрать war файл

```bash
./gradlew war
```

### Шаг 7. Деплой приложения

> Перед выполнением этой команды wildfly должен быть запущен

```bash
./bin/jboss-cli.sh --connect --controller=localhost:9595 --command="deploy is-labs-1.0.war --force"
```

### Фронт

#### Шаг 1. Скомпилировать фронт в статику

```bash
npm run build
```

Всё содержимое полученной папки dist нужно разместить в папке `frontend/www`

#### Шаг 2. Настроить конфигурацию Apache HTTP server

Рядом с папкой `www` нужно разместить файл [httpd.conf](config/httpd.conf)

При этом важно не забыть изменить следующие части файла:

- Порт на котором будет крутиться фронт

    ```text
    Listen 8585
    ```

- Все вхождения `/home/studs/s409642/is-lab/frontend` нужно заменить на абсолютный путь до своей корневой папки фронта

- Настроить параметры проксирования

    ```text
    ProxyPass        /api http://127.0.0.1:8787/is-labs-1.0
    ProxyPassReverse /api http://127.0.0.1:8787/is-labs-1.0
    
    ProxyPass        /ws ws://127.0.0.1:8787/is-labs-1.0
    ProxyPassReverse /ws ws://127.0.0.1:8787/is-labs-1.0
    ```
  
    - `8787` - порт `http` из wildfly
    - `/api` - это адрес по которому будет обращаться фронт для обычных запросов
    - `/ws` это адрес по которому будет обращаться фронт для работы веб-сокетами

### Шаг 3. Запустить Apache HTTP server

```bash
httpd -f ~/is-lab/frontend/httpd.conf -k start
```

Для остановки нужно выполнить

```bash
httpd -f ~/is-lab/frontend/httpd.conf -k stop
```

## Как использовать

Для доступа к сайту достаточно пробросить локальный порт на порт фронта (8585) по ssh
